<div class="manage-students-container">
  <!-- Section Header -->
  <div class="section-header">
    <h1>Manage Students</h1>
    <button class="add-btn" (click)="showAddForm()">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
      Add Student
    </button>
  </div>

  <!-- Alert Messages -->
  <div *ngIf="successMessage" class="alert alert-success">
    {{ successMessage }}
  </div>
  <div *ngIf="errorMessage" class="alert alert-danger">
    {{ errorMessage }}
  </div>

  <!-- Add/Edit Student Form -->
  <div *ngIf="showForm" class="form-container">
    <div class="form-header">
      <h2>{{ isEditMode ? 'Edit Student' : 'Add New Student' }}</h2>
      <button class="close-btn" (click)="cancelForm()">&times;</button>
    </div>
    <form [formGroup]="studentForm" (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label for="email">Email</label>
        <input
          type="email"
          id="email"
          formControlName="email"
          class="form-control"
          [ngClass]="{'is-invalid': isFieldInvalid('email')}"
        >
        <div *ngIf="isFieldInvalid('email')" class="invalid-feedback">
          <span *ngIf="studentForm.get('email')?.errors?.['required']">Email is required</span>
          <span *ngIf="studentForm.get('email')?.errors?.['email']">Please enter a valid email</span>
        </div>
      </div>

      <div class="form-group" *ngIf="!isEditMode">
        <label for="password">Password</label>
        <input
          type="password"
          id="password"
          formControlName="password"
          class="form-control"
          [ngClass]="{'is-invalid': isFieldInvalid('password')}"
        >
        <div *ngIf="isFieldInvalid('password')" class="invalid-feedback">
          <span *ngIf="studentForm.get('password')?.errors?.['required']">Password is required</span>
          <span *ngIf="studentForm.get('password')?.errors?.['minlength']">Password must be at least 6 characters</span>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="cancel-btn" (click)="cancelForm()">Cancel</button>
        <button type="submit" class="submit-btn" [disabled]="studentForm.invalid || isSubmitting">
          {{ isSubmitting ? 'Saving...' : (isEditMode ? 'Update' : 'Add') }}
        </button>
      </div>
    </form>
  </div>

  <!-- Students Table -->
  <div class="students-table-container">
    <table class="students-table" *ngIf="students.length > 0; else emptyState">
      <thead>
        <tr>
          <th>ID</th>
          <th>Email</th>
          <th>Created At</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let student of students">
          <td>{{ student.id }}</td>
          <td>{{ student.email }}</td>
          <td>{{ student.createdAt | date:'medium' }}</td>
          <td class="action-cell">
            <button class="action-btn edit-btn" (click)="editStudent(student)">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
              </svg>
            </button>
            <button class="action-btn delete-btn" (click)="confirmDelete(student)">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
              </svg>
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Empty State -->
    <ng-template #emptyState>
      <div class="empty-state" *ngIf="!isLoading; else loadingSpinner">
        <h3>No students found</h3>
        <p>Add a new student to get started</p>
        <button class="add-btn" (click)="showAddForm()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          Add Student
        </button>
      </div>
    </ng-template>

    <!-- Loading Spinner -->
    <ng-template #loadingSpinner>
      <div class="loading-spinner">
        <div>Loading students...</div>
      </div>
    </ng-template>

    <!-- Pagination -->
    <div class="pagination" *ngIf="students.length > 0">
      <button class="pagination-btn" [disabled]="currentPage === 1" (click)="changePage(currentPage - 1)">
        Previous
      </button>
      <button 
        *ngFor="let page of getPageNumbers()"
        class="pagination-btn"
        [class.active]="currentPage === page"
        (click)="changePage(page)"
      >
        {{ page }}
      </button>
      <button class="pagination-btn" [disabled]="currentPage === totalPages" (click)="changePage(currentPage + 1)">
        Next
      </button>
    </div>
  </div>
</div>